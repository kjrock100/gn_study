# Chromium GN Toolchain 함수 가이드

`toolchain` 함수는 컴파일러, 링커, 아카이버 등 빌드 도구들의 집합을 정의하는 함수입니다. GN은 이 함수를 통해 단일 빌드 내에서 호스트용, 타겟용, 혹은 다른 아키텍처용 빌드를 동시에 수행할 수 있는 강력한 크로스 컴파일 기능을 제공합니다.

## 1. 기본 문법 (Basic Syntax)

```gn
toolchain(toolchain_name) {
  # 도구 정의
  tool("cc") { ... }
  tool("link") { ... }
  
  # 툴체인 인자 설정
  toolchain_args = { ... }
  
  # 기타 변수 (deps 등)
  ...
}
```

*   **`toolchain_name`**: 툴체인의 이름입니다. 라벨에서 이 이름을 사용하여 툴체인을 참조합니다.

## 2. 주요 구성 요소 (Components)

### `tool()` 함수
`toolchain` 블록 내부에서는 `tool()` 함수를 사용하여 각 작업(컴파일, 링크, 복사 등)을 수행할 구체적인 명령어와 규칙을 정의합니다.
*   **필수 도구**: `"stamp"`(타겟 완료 표시), `"copy"`(파일 복사)는 반드시 정의해야 합니다.
*   **주요 도구**: `"cc"`, `"cxx"`, `"alink"`, `"solink"`, `"link"` 등.

### `toolchain_args` 변수
이 툴체인을 사용하여 타겟을 빌드할 때 적용될 **빌드 인자(Build Arguments)**를 정의하는 스코프(Scope)입니다.
*   **역할**: `declare_args`로 선언된 전역 빌드 인자의 값을 이 툴체인 컨텍스트 내에서만 오버라이드합니다.
*   **용도**: 주로 `current_cpu`, `current_os`를 설정하여 크로스 컴파일 환경을 구성하는 데 사용됩니다.

```gn
toolchain_args = {
  current_cpu = "arm64"
  current_os = "android"
  is_debug = false
}
```

### `deps` (선택 사항)
툴체인 자체의 의존성을 지정합니다. 예를 들어, 컴파일러 바이너리 자체가 빌드되어야 하는 경우(예: Clang 부트스트랩), 그 타겟을 여기에 지정할 수 있습니다.

## 3. 사용 예시 (Usage Examples)

### 3.1. 기본 툴체인 정의

```gn
toolchain("gcc_toolchain") {
  tool("cc") {
    command = "gcc -c {{source}} -o {{output}}"
    outputs = [ "{{source_out_dir}}/{{target_output_name}}.{{source_name_part}}.o" ]
    description = "CC {{output}}"
  }
  
  # ... (cxx, link 등 다른 도구 정의) ...

  tool("stamp") {
    command = "touch {{output}}"
    description = "STAMP {{output}}"
  }

  tool("copy") {
    command = "cp -af {{source}} {{output}}"
    description = "COPY {{source}} {{output}}"
  }
}
```

## 4. 주의사항

*   **완전성**: `toolchain` 정의는 독립적이어야 합니다. 툴체인 내부에서 외부 스코프의 변수에 의존하면, 툴체인이 다시 로드될 때(예: 다른 툴체인 컨텍스트에서) 의도치 않은 동작이 발생할 수 있습니다.
*   **`toolchain_args` 전파**: `toolchain_args`에 설정된 변수들은 해당 툴체인으로 빌드되는 모든 타겟의 `declare_args` 기본값을 덮어씁니다.
*   **필수 도구**: `stamp`와 `copy` 도구를 정의하지 않으면 GN 실행 시 오류가 발생합니다.
