# Chromium GN Foreach 함수 가이드

`foreach` 함수는 리스트의 각 요소를 순회하며 블록 내의 코드를 실행하는 반복문입니다. 리스트에 있는 데이터(소스 파일 목록, 설정 목록 등)를 기반으로 여러 타겟을 동적으로 정의하거나, 반복적인 작업을 수행할 때 사용됩니다.

## 1. 기본 문법 (Basic Syntax)

```gn
foreach(loop_var, list) {
  # loop_var를 사용하여 작업 수행
  print(loop_var)
}
```

*   **`loop_var`**: 현재 반복 중인 리스트의 요소를 담을 변수 이름입니다.
*   **`list`**: 순회할 리스트입니다.
*   **블록(`{ ... }`)**: 리스트의 각 요소마다 한 번씩 실행될 코드 블록입니다.

## 2. 스코프 규칙 (Scoping Rules)

`foreach` 문은 **새로운 스코프(Scope)**를 생성합니다. 이는 매우 중요한 특징입니다.

*   **외부 변수 접근**: 반복문 내부에서 외부 스코프의 변수를 읽을 수 있습니다.
*   **변수 격리**: 반복문 내부에서 정의하거나 수정한 변수는 반복문이 끝나면 사라집니다. 외부 스코프에 영향을 주지 않습니다.
*   **Shadowing**: 내부에서 외부 변수와 같은 이름의 변수에 값을 할당하면, 새로운 로컬 변수가 생성되어 외부 변수를 가립니다.

```gn
a = "outside"
list = [ 1, 2 ]

foreach(i, list) {
  a = "inside" # 로컬 변수 a 생성
  print(a)     # "inside" 출력
}

print(a)       # "outside" 출력 (변경되지 않음)
```

## 3. 사용 예시 (Usage Examples)

### 3.1. 동적 타겟 정의

여러 라이브러리나 플러그인을 리스트로 관리하고, 반복문을 통해 각각에 대한 타겟을 생성하는 패턴입니다.

```gn
my_plugins = [
  "foo_plugin",
  "bar_plugin",
  "baz_plugin",
]

foreach(plugin, my_plugins) {
  shared_library(plugin) {
    sources = [ "$plugin.cc" ]
    defines = [ "IS_PLUGIN" ]
  }
}
```

### 3.2. 리스트 필터링 및 가공

조건문을 사용하여 리스트의 특정 요소에 대해서만 작업을 수행할 수 있습니다.

```gn
support_modules = [
  { name = "xml", enabled = true },
  { name = "json", enabled = true },
  { name = "yaml", enabled = false },
]

foreach(module, support_modules) {
  if (module.enabled) {
    source_set("${module.name}_support") {
      sources = [ "${module.name}_parser.cc" ]
    }
  }
}
```

## 4. `foreach` vs `action_foreach`

*   **`foreach`**: GN 언어 레벨의 반복문입니다. GN 파일이 파싱되고 실행되는 시점(Gen-time)에 동작합니다. 타겟을 정의하거나 변수를 조작하는 데 사용됩니다.
*   **`action_foreach`**: 빌드 타겟의 일종입니다. Ninja 빌드 시점(Build-time)에 실행되며, 소스 파일 하나당 스크립트를 한 번씩 실행하는 빌드 규칙을 생성합니다.

**파일 변환 빌드 스텝을 정의하려면 `foreach`가 아니라 `action_foreach`를 사용해야 합니다.**
