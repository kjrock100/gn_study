# Chromium GN process_file_template 함수 가이드

`process_file_template` 함수는 소스 파일 목록과 치환 패턴(template)을 입력받아, 각 소스 파일에 패턴을 적용하여 새로운 파일 경로 목록을 생성합니다. 주로 `action` 타겟에서 입력 파일(`sources`)에 대응하는 출력 파일(`outputs`) 목록을 동적으로 생성할 때 사용됩니다.

## 1. 기본 문법 (Basic Syntax)

```gn
output_list = process_file_template(sources, template)
```

*   **`sources`**: 변환할 원본 파일 경로들의 리스트입니다.
*   **`template`**: `sources`의 각 파일에 적용할 치환 패턴들의 리스트입니다.

## 2. 작동 방식 (How it works)

`process_file_template`는 `sources` 리스트의 각 파일에 대해 `template` 리스트의 각 패턴을 적용합니다.

예를 들어, `sources`가 2개이고 `template`이 3개라면, 총 2 * 3 = 6개의 항목을 가진 리스트가 생성됩니다.

## 3. 치환 패턴 (Substitution Patterns)

`template` 문자열 내에서 사용할 수 있는 주요 패턴입니다.

*   `{{source}}`: 소스 파일의 전체 경로 (예: `//foo/bar.cc`).
*   `{{source_name_part}}`: 확장자를 제외한 파일 이름 (예: `bar`).
*   `{{source_file_part}}`: 파일 이름과 확장자 (예: `bar.cc`).
*   `{{source_dir}}`: 소스 파일이 있는 디렉토리 (예: `//foo`).
*   `{{source_root_relative_dir}}`: 소스 루트에 대한 상대 디렉토리 (예: `foo`).
*   `{{source_gen_dir}}`: 소스 파일 디렉토리에 대응하는 생성 파일 디렉토리 (예: `gen/foo`).
*   `{{source_out_dir}}`: 소스 파일 디렉토리에 대응하는 객체 파일 출력 디렉토리 (예: `obj/foo`).

## 4. 사용 예시 (Usage Example)

### IDL 파일로부터 .h와 .cc 파일 생성하기

`action` 타겟에서 IDL 컴파일러를 실행하여 각 IDL 파일마다 헤더와 소스 파일을 생성하는 경우입니다.

```gn
action("compile_idls") {
  script = "idl_compiler.py"
  
  sources = [
    "api/my_interface.idl",
    "api/other_interface.idl",
  ]

  # 각 소스 파일에 대해 적용할 출력 파일 패턴 정의
  # 이 경우, 각 .idl 파일마다 .h와 .cc 파일이 생성됨
  outputs = process_file_template(sources, [
    "$target_gen_dir/{{source_name_part}}.h",
    "$target_gen_dir/{{source_name_part}}.cc",
  ])

  # 스크립트에 모든 소스 파일을 한 번에 전달
  args = [
    "--output_dir=" + rebase_path(target_gen_dir, root_build_dir),
  ]
  args += rebase_path(sources, root_build_dir)
}
```

**`outputs` 변수의 결과:**

```
[
  "gen/idl_compiler/my_interface.h",
  "gen/idl_compiler/my_interface.cc",
  "gen/idl_compiler/other_interface.h",
  "gen/idl_compiler/other_interface.cc",
]
```

## 5. `action_foreach`와의 차이점

*   **`action_foreach`**: `sources`의 각 파일마다 스크립트를 **개별적으로** 실행합니다. 1:1 파일 변환에 적합하며, `outputs`와 `args`에 내장된 치환 패턴을 직접 사용합니다.
*   **`process_file_template`**: 스크립트 실행 전에 **미리** 출력 파일 목록을 생성합니다. 스크립트가 모든 입력 파일을 한 번에 받아 여러 출력 파일을 생성하는 `action` 타겟과 함께 사용될 때 유용합니다.
