# Chromium GN exec_script 함수 가이드

`exec_script` 함수는 **GN 생성 시간(Gen-time)**, 즉 `gn gen` 명령이 실행되는 동안 동기적으로 외부 스크립트를 실행하고, 그 결과를 GN 변수에 담아 빌드 로직에 활용하는 데 사용됩니다.

**경고: `exec_script`는 GN 실행 속도를 현저히 저하시킬 수 있으므로, 꼭 필요한 경우에만 사용해야 합니다.** 대부분의 파일 생성 작업은 빌드 시간(Build-time)에 실행되는 `action` 타겟으로 처리하는 것이 좋습니다.

## 1. 기본 구조 (Basic Structure)

```gn
# 스크립트의 표준 출력(stdout)을 변수에 저장
version_string = exec_script("get_version.py", [], "trim string")

if (version_string == "1.2.3") {
  # ...
}
```

## 2. 문법 (Syntax)

```gn
exec_script(script_path, args, input_conversion, file_dependencies)
```

*   **`script_path` (필수)**: 실행할 스크립트의 경로입니다.
*   **`args` (선택 사항)**: 스크립트에 전달할 인자 리스트입니다. (기본값: `[]`)
*   **`input_conversion` (선택 사항)**: 스크립트의 표준 출력(stdout)을 어떤 GN 자료형으로 변환할지 지정합니다. (기본값: `""`, 출력 무시)
    *   `"string"`: 전체 출력을 단일 문자열로 변환.
    *   `"trim string"`: 양 끝의 공백을 제거한 단일 문자열로 변환.
    *   `"list lines"`: 출력을 줄(line) 단위로 나누어 리스트로 변환.
    *   `"value"`: 출력을 GN 문법으로 파싱하여 GN 값(리스트, 스코프 등)으로 변환.
*   **`file_dependencies` (선택 사항)**: 스크립트가 의존하는 파일 목록입니다. 이 파일들이 변경되면, 다음 `ninja` 실행 시 GN이 자동으로 다시 실행됩니다. (기본값: `[]`)

## 3. `action`과의 차이점

| 특징 | `exec_script` | `action` |
| :--- | :--- | :--- |
| **실행 시점** | GN 생성 시간 (Gen-time) | 빌드 시간 (Build-time) |
| **실행 주체** | GN | Ninja |
| **결과 활용** | GN 변수에 저장하여 빌드 로직에 사용 | 파일(`outputs`)을 생성하여 다른 타겟의 입력으로 사용 |
| **성능** | 느림 (동기 실행, GN 프로세스 블로킹) | 빠름 (병렬 실행 가능) |

## 4. 사용 예시 (Usage Examples)

### 4.1. 컴파일러 버전 확인

```python
# get_compiler_version.py
import sys
import subprocess
version = subprocess.check_output(['gcc', '--version']).decode('utf-8').splitlines()[0]
print(version)
```

```gn
# BUILD.gn
compiler_version = exec_script("get_compiler_version.py", [], "trim string")
if (compiler_version == "gcc (Ubuntu 9.4.0-1ubuntu1~20.04.1) 9.4.0") {
  # ...
}
```

### 4.2. 파일 목록 읽어오기

```python
# find_data_files.py
import os
for f in os.listdir('data'):
  if f.endswith('.json'):
    print(f"data/{f}")
```

```gn
# BUILD.gn
data_files = exec_script("find_data_files.py", [], "list lines")

copy("copy_data") {
  sources = data_files
  outputs = [ "$root_out_dir/{{source_file_part}}" ]
}
```

## 5. 언제 사용해야 하는가?

`exec_script`는 다음과 같이 빌드 파일 생성 자체에 영향을 주는 정보를 얻어야 할 때 제한적으로 사용해야 합니다.

*   시스템에 설치된 도구의 버전이나 경로를 확인해야 할 때.
*   빌드 구성에 필요한 시스템 설정을 동적으로 감지해야 할 때.
*   파일 시스템을 탐색하여 동적으로 소스 파일 목록을 구성해야 할 때 (권장하지 않음, 성능 저하가 큼).

**대부분의 코드 생성이나 파일 변환 작업은 `action` 또는 `action_foreach`를 사용하는 것이 올바른 방법입니다.**
