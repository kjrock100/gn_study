# Chromium GN rebase_path 함수 가이드

`rebase_path` 함수는 GN에서 경로를 처리하는 가장 중요하고 강력한 함수 중 하나입니다. 이 함수는 입력 경로의 기준점(Base)을 변경하여, 다른 컨텍스트(예: 빌드 디렉토리, 소스 루트)에 맞는 상대 경로 또는 절대 경로를 생성합니다.

## 1. 기본 문법 (Basic Syntax)

```gn
result = rebase_path(input, new_base, current_base)
```

*   **`input` (필수)**: 변환할 경로입니다. 단일 문자열 또는 경로들의 리스트일 수 있습니다.
*   **`new_base` (선택 사항)**: 결과 경로가 기준으로 삼을 새로운 디렉토리입니다.
    *   생략하거나 빈 문자열(`""`)로 지정하면, 결과는 **시스템 절대 경로**가 됩니다.
    *   경로를 지정하면, 결과는 해당 디렉토리를 기준으로 한 **상대 경로**가 됩니다.
*   **`current_base` (선택 사항)**: `input`이 상대 경로일 경우, 어떤 디렉토리를 기준으로 해석할지 지정합니다. 기본값은 현재 `BUILD.gn` 파일이 위치한 디렉토리입니다.

## 2. 주요 사용 패턴

### 2.1. 스크립트 인자로 경로 전달 (가장 흔한 패턴)

`action` 타겟에서 실행되는 스크립트는 보통 빌드 디렉토리(`root_build_dir`)를 현재 작업 디렉토리(CWD)로 하여 실행됩니다. 따라서 소스 파일 경로는 **빌드 디렉토리 기준의 상대 경로**로 변환해서 전달해야 합니다.

```gn
action("my_script") {
  script = "process.py"
  sources = [ "data/input.txt" ]
  outputs = [ "$target_gen_dir/output.bin" ]

  # "data/input.txt"를 빌드 디렉토리(out/Default) 기준 상대 경로로 변환
  # 예: "../../my_module/data/input.txt"
  args = [
    "--input",
    rebase_path(sources[0], root_build_dir),
    "--output",
    rebase_path(outputs[0], root_build_dir),
  ]
}
```

### 2.2. 소스 루트 기준 경로로 변환

다양한 위치의 파일 경로들을 일관된 소스 루트(`//`) 기준 경로로 정규화할 때 사용합니다.

```gn
relative_path = "foo/bar.txt"

# "//"를 new_base로 지정하면 소스 루트 기준 상대 경로가 됨
source_absolute_path = rebase_path(relative_path, "//")
# 결과: "//current_dir/foo/bar.txt"
```

### 2.3. 시스템 절대 경로 얻기

`new_base`를 생략하면 시스템 절대 경로를 얻을 수 있습니다. (빌드 재현성을 해치므로 사용에 주의해야 합니다.)

```gn
# 현재 디렉토리의 "foo.txt"를 시스템 절대 경로로 변환
abs_path = rebase_path("foo.txt")
```

## 3. 리스트 처리

`rebase_path`는 경로 리스트를 한 번에 처리할 수 있습니다.

```gn
my_sources = [
  "a.cc",
  "b.cc",
]

rebased_sources = rebase_path(my_sources, root_build_dir)
```

## 4. `current_base` 사용

`rebase_path`가 호출되는 위치가 아닌 다른 디렉토리를 기준으로 상대 경로를 해석해야 할 때 `current_base`를 사용합니다.

```gn
# //foo/BUILD.gn 에서

# //bar/baz.txt 를 기준으로 "data.txt" 경로를 해석
path = rebase_path("data.txt",
                   root_build_dir,
                   get_path_info("//bar/baz.txt", "dir"))
```
