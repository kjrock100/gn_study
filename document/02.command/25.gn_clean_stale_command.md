# Chromium GN Clean Stale 명령어 가이드

`gn clean_stale`은 빌드 디렉토리에서 현재 빌드 구성(Ninja 파일)에 정의되지 않은, 즉 더 이상 필요하지 않은 "오래된(stale)" 파일들을 삭제하는 명령어입니다.

## 1. 기본 사용법 (Basic Usage)

```bash
gn clean_stale <out_dir>
```

*   **예시**:
    ```bash
    gn clean_stale out/Default
    ```

## 2. 기능 및 목적

소스 코드를 수정하거나 브랜치를 변경하다 보면, 이전에 빌드되었지만 현재는 삭제되거나 이름이 변경된 타겟의 산출물들이 빌드 디렉토리에 남게 됩니다. 이러한 파일들을 "Stale files"라고 합니다.

`gn clean_stale`은 Ninja 빌드 파일(`build.ninja` 및 관련 파일)을 분석하여, 현재 빌드 그래프에 존재하지 않는 파일들을 찾아 삭제합니다.

### 주요 이점
*   **디스크 공간 확보**: 불필요한 객체 파일(`.o`), 실행 파일 등을 정리합니다.
*   **빌드 오류 방지**: 오래된 헤더 파일이나 라이브러리가 링킹 과정에 잘못 포함되어 발생하는 미묘한 빌드 오류를 방지할 수 있습니다.
*   **시간 절약**: `gn clean`으로 전체를 지우고 다시 빌드하는 것보다 훨씬 빠릅니다. 필요한 파일은 유지하고 불필요한 것만 지우기 때문입니다.

## 3. `gn clean` vs `gn clean_stale`

| 명령어 | 삭제 대상 | 빌드 상태 | 사용 시점 |
| :--- | :--- | :--- | :--- |
| `gn clean` | `args.gn`을 제외한 모든 파일 | 초기화됨 (Full Rebuild 필요) | 빌드가 완전히 꼬였거나 디스크를 비울 때 |
| `gn clean_stale` | 현재 빌드에 없는 파일만 | 유지됨 (Incremental Build 가능) | 타겟 삭제/이름 변경 후, 브랜치 변경 후 |

## 4. 주의사항

*   **선행 조건**: 이 명령어는 `build.ninja` 파일에 나열된 출력 파일 목록을 기준으로 동작합니다. 따라서 `gn gen`을 먼저 실행하여 빌드 파일이 최신 상태인지 확인하는 것이 좋습니다.
    ```bash
    gn gen out/Default
    gn clean_stale out/Default
    ```
*   **사용자 파일 삭제**: 빌드 디렉토리 내에 사용자가 임의로 생성한 파일이 있고, 그 파일이 빌드 스크립트의 출력물이 아니라면 Ninja가 모르는 파일이므로 삭제될 수 있습니다.
