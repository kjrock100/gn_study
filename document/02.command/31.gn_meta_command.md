# Chromium GN Meta 명령어 가이드

`gn meta`는 타겟(Target)에 정의된 **메타데이터(Metadata)**를 조회하고 수집 결과를 확인하는 명령어입니다. GN의 `metadata` 변수와 `generated_file` 타겟이 의존성 트리에서 데이터를 어떻게 수집하는지 디버깅할 때 필수적인 도구입니다.

## 1. 메타데이터(Metadata)란?

GN에서 타겟은 `metadata` 변수를 통해 임의의 구조화된 데이터를 정의할 수 있습니다. 이 데이터는 의존성 트리(Dependency Tree)를 따라 수집되어, `generated_file` 타겟을 통해 JSON 파일이나 텍스트 파일로 출력될 수 있습니다.

```gn
source_set("my_lib") {
  sources = [ "lib.cc" ]
  # 메타데이터 정의
  metadata = {
    my_files = [ "lib.cc" ]
    my_barrier = []
  }
}
```

## 2. 기본 사용법 (Basic Usage)

```bash
gn meta <out_dir> <target_label> [<key>...] [--walk_keys=<keys>] [--rebase=<dir>]
```

*   **`<out_dir>`**: 빌드 디렉토리 경로 (예: `out/Default`).
*   **`<target_label>`**: 메타데이터 수집을 시작할 루트 타겟.
*   **`[<key>...]`**: (선택 사항) 값을 조회할 메타데이터 키 이름들. 생략하면 사용 가능한 모든 키를 나열합니다.

### 예시

```bash
# //app:my_app 타겟과 그 의존성들에 정의된 "my_files" 키의 값들을 수집
gn meta out/Default //app:my_app my_files
```

## 3. 동작 원리 (Collection Logic)

`gn meta`는 `generated_file` 타겟이 데이터를 수집하는 방식과 동일하게 동작합니다.

1.  **순회 (Walk)**: 지정된 타겟에서 시작하여 `deps`를 따라 깊이 우선 탐색(DFS)으로 내려갑니다.
2.  **수집 (Collect)**: 각 타겟의 `metadata` 변수에서 요청된 키(`data_keys`)에 해당하는 값을 리스트에 추가합니다.
3.  **장벽 (Barrier)**: `walk_keys`에 지정된 키가 타겟의 `metadata`에 존재하면, 그 타겟의 하위 의존성으로는 더 이상 내려가지 않습니다(Pruning).

## 4. 주요 옵션

### `--walk_keys`
의존성 탐색을 멈출 "장벽(Barrier)" 키를 지정합니다. 쉼표로 구분하여 여러 개를 지정할 수 있습니다.

```bash
# "my_barrier" 키가 있는 타겟까지만 탐색하고 그 하위는 무시
gn meta out/Default //app:my_app my_files --walk_keys="my_barrier"
```

### `--rebase`
수집된 데이터가 파일 경로인 경우, 특정 디렉토리를 기준으로 경로를 변환하여 출력합니다.

```bash
# 수집된 경로를 소스 루트(//) 기준으로 변환
gn meta out/Default //app:my_app my_files --rebase="//"
```

## 5. 활용 팁

`generated_file` 타겟을 작성했는데 예상한 데이터가 출력 파일에 포함되지 않거나, 불필요한 데이터가 포함될 때 `gn meta`를 사용하여 디버깅합니다.

1.  `generated_file` 타겟이 의존하는 타겟을 대상으로 `gn meta`를 실행합니다.
2.  `--walk_keys` 옵션에 `generated_file`의 `walk_keys` 값을 동일하게 줍니다.
3.  출력 결과를 보며 의존성 그래프의 어느 부분에서 데이터가 누락되었는지 확인합니다.
