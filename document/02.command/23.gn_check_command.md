# Chromium GN Check 명령어 가이드

`gn check`는 소스 코드의 헤더 파일 포함(include) 관계가 GN 빌드 파일의 의존성(dependency) 설정과 일치하는지 검증하는 명령어입니다. 이는 "헤더 의존성"을 강제하여 빌드 그래프의 정확성을 유지하고, 누락된 의존성으로 인한 잠재적인 빌드 오류를 방지합니다.

## 1. 검사 원리 (How it works)

C/C++ 소스 파일이 `#include "foo/bar.h"`를 포함하고 있다면, GN은 다음 조건을 확인합니다.

1.  현재 타겟이 `foo/bar.h`를 포함하는 타겟을 `deps` 또는 `public_deps`로 가지고 있는가?
2.  또는, `foo/bar.h`가 현재 타겟의 `sources`에 포함되어 있는가?

만약 이 조건이 만족되지 않으면 `gn check`는 오류를 보고합니다. 이는 링커 에러가 발생하기 전에 논리적인 의존성 오류를 잡아내는 데 유용합니다.

## 2. 기본 사용법 (Basic Usage)

```bash
gn check <out_dir> [target_label]
```

*   **전체 검사**: 빌드 디렉토리의 모든 타겟을 검사합니다.
    ```bash
    gn check out/Default
    ```
*   **특정 타겟 검사**: 특정 타겟과 그 의존성만 검사합니다.
    ```bash
    gn check out/Default //base:base
    ```

## 3. 오류 해결 (Fixing Errors)

가장 흔한 오류 메시지는 "Include not allowed"입니다.

```text
ERROR at //my_app/main.cc:5:10: Include not allowed.
#include "utils/helper.h"
         ^--------------
It is not in any dependency of
  //my_app:my_app
The include file is in the target(s):
  //utils:utils
which should somehow be reachable.
```

### 해결 방법
`//my_app` 타겟의 `deps`에 `//utils`를 추가해야 합니다.

```gn
executable("my_app") {
  sources = [ "main.cc" ]
  deps = [ "//utils" ] # 의존성 추가
}
```

## 4. 고급 설정 및 예외 처리

### `public_deps` vs `deps`
*   헤더 파일(`my_lib.h`) 내부에서 다른 라이브러리의 헤더(`base/logging.h`)를 include 한다면, `base` 라이브러리는 `public_deps`로 선언되어야 합니다. 그래야 `my_lib`을 사용하는 쪽에서도 `base`의 헤더를 사용할 수 있습니다.

### `allow_circular_includes_from`
서로 다른 타겟 간에 헤더 순환 참조가 불가피한 경우(예: 거대한 레거시 코드 분리 중), 이를 허용하도록 설정할 수 있습니다.

```gn
source_set("a") {
  sources = [ "a.h", "a.cc" ]
  deps = [ ":b" ]
  
  # b의 헤더가 a를 include 하는 것을 허용
  allow_circular_includes_from = [ ":b" ]
}
```

### `nogncheck` 주석
특정 include 라인만 검사에서 제외하고 싶다면 `nogncheck` 주석을 사용합니다. (권장하지 않음, 최후의 수단)

```cpp
#include "hacky/header.h"  // nogncheck
```
