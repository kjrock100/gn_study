# Chromium GN Generated File 타겟 가이드

`generated_file` 타겟은 빌드 과정에서 **파일을 생성**하는 데 사용됩니다. 두 가지 주요 용도가 있습니다:
1.  고정된 내용(문자열 또는 리스트)을 파일로 쓰기.
2.  의존성 트리에서 **메타데이터(Metadata)**를 수집하여 파일로 쓰기.

## 1. 기본 구조 (Basic Structure)

```gn
generated_file("my_file") {
  outputs = [ "$target_gen_dir/my_config.json" ]
  contents = {
    key = "value"
    feature_enabled = true
  }
  output_conversion = "json"
}
```

## 2. 주요 변수 (Key Variables)

### `outputs` (필수)
생성할 파일의 경로입니다. 리스트여야 하지만, **단 하나의 파일**만 지정할 수 있습니다.

### `contents`
파일에 쓸 내용을 정의합니다.
*   문자열, 리스트, 스코프(딕셔너리) 등 GN의 기본 자료형을 사용할 수 있습니다.
*   `data_keys`와 함께 사용될 수 없습니다.

### `data_keys` (메타데이터 수집용)
의존성 트리에서 수집할 메타데이터 변수의 이름 목록입니다.
*   이 변수가 설정되면, `generated_file`은 의존성(`deps`)을 순회하며 각 타겟의 `metadata` 변수에서 해당 키의 값을 수집하여 리스트로 만듭니다.

### `walk_keys` (메타데이터 수집용)
메타데이터 수집 시 탐색을 멈출 "장벽(Barrier)" 키 목록입니다.
*   탐색 중인 타겟의 `metadata`에 이 키가 포함되어 있으면, 그 타겟의 하위 의존성은 더 이상 탐색하지 않습니다.

### `rebase` (메타데이터 수집용)
수집된 데이터가 파일 경로인 경우, 지정된 디렉토리를 기준으로 경로를 변환합니다. (예: `root_build_dir`)

### `output_conversion`
`contents`나 수집된 데이터를 파일로 쓸 때의 형식을 지정합니다.
*   `"json"`: JSON 형식으로 출력.
*   `"json_value"`: (리스트가 아닌) 단일 JSON 값으로 출력.
*   `"string"`: 문자열로 출력.
*   `"value"`: GN 값 그대로 출력.
*   `"list lines"`: 리스트의 각 요소를 한 줄씩 출력.

## 3. 사용 예시 (Usage Examples)

### 3.1. 정적 JSON 파일 생성

```gn
generated_file("config_json") {
  outputs = [ "$target_gen_dir/config.json" ]
  contents = {
    version = "1.0"
    debug = is_debug
    features = [ "a", "b" ]
  }
  output_conversion = "json"
}
```

### 3.2. 메타데이터 수집 (Metadata Collection)

여러 라이브러리에 분산된 정보를 모아서 하나의 리스트 파일로 만드는 예제입니다.

**라이브러리 정의:**
```gn
source_set("lib_a") {
  sources = [ "a.cc" ]
  metadata = {
    my_tests = [ "test_a" ]
  }
}

source_set("lib_b") {
  sources = [ "b.cc" ]
  metadata = {
    my_tests = [ "test_b" ]
  }
}
```

**수집 타겟 정의:**
```gn
generated_file("all_tests") {
  outputs = [ "$target_gen_dir/tests.txt" ]
  data_keys = [ "my_tests" ]
  deps = [ ":lib_a", ":lib_b" ]
  output_conversion = "list lines"
}
```
위 예제에서 `tests.txt` 파일은 다음과 같이 생성됩니다:
```text
test_a
test_b
```

## 4. 주의사항

*   `generated_file`은 `action` 타겟을 사용하여 `write_file`을 호출하는 것보다 효율적입니다.
*   `contents`와 `data_keys`는 동시에 사용할 수 없습니다.
