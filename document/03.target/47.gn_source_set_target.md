# Chromium GN Source Set 타겟 가이드

`source_set` 타겟은 소스 파일들을 컴파일하여 **객체 파일(Object Files, `.o`)들의 집합**으로 처리하는 GN의 독특하고 중요한 타겟 유형입니다. 정적 라이브러리(`.a`, `.lib`)를 생성하지 않는다는 점이 가장 큰 특징입니다.

Chromium 프로젝트에서는 대부분의 내부 코드를 `static_library` 대신 `source_set`으로 관리하는 것을 권장합니다.

## 1. 기본 구조 (Basic Structure)

```gn
source_set("my_utils") {
  sources = [
    "util.cc",
    "util.h",
  ]

  deps = [ "//base" ]
  defines = [ "USE_MY_UTILS" ]
}
```

## 2. 주요 특징 및 장점

### 링킹 최적화 (Linking Optimization)
`source_set`은 중간 아카이브 파일(`.a`)을 생성하지 않습니다. 이 타겟을 의존하는 최종 타겟(`executable` 또는 `shared_library`)이 링크될 때, `source_set`의 객체 파일들이 마치 최종 타겟의 `sources`에 직접 포함된 것처럼 처리됩니다.

*   **Dead Code Stripping**: 링커가 사용되지 않는 함수나 심볼을 더 효과적으로 제거할 수 있어 바이너리 크기가 줄어듭니다.
*   **속도**: 아카이빙 단계가 생략되므로 증분 빌드 속도가 약간 더 빠를 수 있습니다.

### 헤더 파일 관리
C++ 헤더 파일만 포함하는 라이브러리(Header-only library)를 정의할 때도 `source_set`이 적합합니다.

## 3. `source_set` vs `static_library`

| 특징 | `source_set` | `static_library` |
| :--- | :--- | :--- |
| **산출물** | 없음 (객체 파일들의 논리적 집합) | 정적 라이브러리 파일 (`.a`, `.lib`) |
| **링킹 방식** | 객체 파일들이 최종 타겟에 직접 전달됨 | 라이브러리 파일 전체가 링커에 전달됨 |
| **심볼 제거** | 링커가 미사용 심볼을 쉽게 제거함 | 링커 설정에 따라 전체가 포함될 수 있음 |
| **오버헤드** | 아카이빙 과정 없음 | 아카이빙 과정 있음 |
| **용도** | 프로젝트 내부 모듈, 대부분의 코드 | 외부 배포용 라이브러리, 캐싱이 필요한 거대 모듈 |

## 4. 주요 변수 (Key Variables)

*   **`sources`**: 컴파일할 소스 파일 목록.
*   **`deps`**: 내부 구현에 필요한 의존성.
*   **`public_deps`**: 이 `source_set`을 사용하는 타겟에게도 전파해야 하는 의존성 (주로 헤더 파일 include 관련).
*   **`configs`**: 컴파일러 설정.
*   **`all_dependent_configs`**: (사용 지양) 이 타겟을 의존하는 모든 타겟에게 설정을 전파.
*   **`public_configs`**: 이 타겟을 의존하는 타겟에게 설정을 전파 (include 경로 등).

## 5. 사용 예시 (Usage Examples)

### 일반적인 유틸리티 모듈

```gn
source_set("string_utils") {
  sources = [ "string_utils.cc", "string_utils.h" ]
  public_deps = [ "//third_party/icu" ] # 헤더에서 ICU 타입을 사용함
}

executable("my_app") {
  sources = [ "main.cc" ]
  deps = [ ":string_utils" ]
}
```

### 헤더 온리 라이브러리 (Header-only)

```gn
source_set("math_templates") {
  sources = [ "math_templates.h" ]
}
```
