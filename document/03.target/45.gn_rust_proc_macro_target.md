# Chromium GN Rust Proc Macro 타겟 가이드

`rust_proc_macro` 타겟은 Rust의 **절차적 매크로(Procedural Macro)**를 정의하는 라이브러리 크레이트를 생성하는 데 사용됩니다. 이 타겟으로 생성된 라이브러리는 컴파일 타임에 컴파일러에 의해 로드되어 코드를 생성하거나 변형하는 역할을 합니다.

## 1. 역할 (Role)

*   **컴파일 타임 실행**: 일반적인 라이브러리와 달리, 이 타겟은 빌드 과정 중에 Rust 컴파일러(`rustc`)가 로드하여 실행합니다.
*   **매크로 정의**: `#[derive(MyMacro)]`나 `my_macro!()`와 같은 커스텀 매크로를 정의할 때 사용합니다.

## 2. 기본 구조 (Basic Structure)

```gn
rust_proc_macro("my_macro") {
  crate_name = "my_macro"
  sources = [ "src/lib.rs" ]
  edition = "2021"
  deps = [ "//third_party/rust/syn", "//third_party/rust/quote" ]
}
```

## 3. 주요 변수 (Key Variables)

### `sources`
컴파일할 Rust 소스 파일 목록입니다. 진입점 파일(보통 `lib.rs`)이 포함되어야 합니다.

### `crate_name`
크레이트 이름입니다. Rust 코드에서 이 매크로를 가져올 때 사용하는 이름입니다.

### `edition`
Rust 에디션 (예: `"2021"`).

### `deps`
매크로 구현에 필요한 의존성입니다. 절차적 매크로는 보통 구문 분석을 위해 `syn`, `quote`, `proc-macro2` 같은 크레이트를 많이 사용합니다.

## 4. 사용 예시 (Usage Example)

### 매크로 정의 (`rust_proc_macro`)

```gn
# //my_macro/BUILD.gn
rust_proc_macro("my_derive") {
  crate_name = "my_derive"
  sources = [ "src/lib.rs" ]
  edition = "2021"
  deps = [
    "//third_party/rust/syn",
    "//third_party/rust/quote",
    "//third_party/rust/proc_macro2",
  ]
}
```

### 매크로 사용 (`rust_library` / `rust_executable`)

다른 Rust 타겟에서 `deps`에 추가하여 사용합니다.

```gn
# //app/BUILD.gn
rust_executable("my_app") {
  sources = [ "src/main.rs" ]
  deps = [ "//my_macro:my_derive" ]
  edition = "2021"
}
```

## 5. 주의사항

*   **`proc-macro` 크레이트 타입**: 이 타겟은 Rust의 `proc-macro` 크레이트 타입으로 컴파일됩니다.
*   **크로스 컴파일**: 절차적 매크로는 컴파일러가 실행해야 하므로, 타겟 아키텍처가 아닌 **호스트 아키텍처(Host Architecture)**로 컴파일됩니다. GN이 이를 자동으로 처리하지만, 툴체인 설정 시 이해하고 있어야 합니다.
