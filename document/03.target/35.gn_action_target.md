# Chromium GN Action 타겟 가이드

`action` 타겟은 빌드 과정 중에 스크립트(주로 Python)를 실행하여 하나 이상의 출력 파일을 생성하는 커스텀 빌드 단계를 정의할 때 사용합니다. 코드 생성, 데이터 변환, 파일 압축 등의 작업에 필수적입니다.

## 1. 기본 구조 (Basic Structure)

```gn
action("my_action") {
  script = "tools/process.py"
  sources = [ "input.data" ]
  outputs = [ "$target_gen_dir/output.cc" ]

  args = [
    "--input", rebase_path(sources[0], root_build_dir),
    "--output", rebase_path(outputs[0], root_build_dir),
  ]
}
```

## 2. 주요 변수 (Key Variables)

### `script` (필수)
실행할 스크립트 파일의 경로입니다. GN은 Python 스크립트 실행을 기본으로 지원합니다.
*   경로는 소스 루트(`//`) 또는 현재 디렉토리 기준 상대 경로로 지정합니다.

### `outputs` (필수)
스크립트 실행 결과로 생성되는 파일들의 목록입니다.
*   **중요**: 스크립트가 실제로 생성하는 파일과 이 리스트가 정확히 일치해야 합니다.
*   이 파일들은 다른 타겟의 `sources`로 사용될 수 있으며, Ninja는 이 파일들의 타임스탬프를 기준으로 재빌드 여부를 결정합니다.
*   주로 `$target_gen_dir` 또는 `$root_gen_dir` 하위에 생성합니다.

### `sources` / `inputs`
스크립트가 읽어들이는 입력 파일 목록입니다.
*   이 파일들이 변경되면 스크립트가 다시 실행됩니다.
*   `sources`: 주로 변환 대상이 되는 주요 입력 파일.
*   `inputs`: 스크립트 실행에 필요하지만 변환 대상은 아닌 보조 파일 (예: 설정 파일, 템플릿).

### `args`
스크립트에 전달할 커맨드 라인 인자 리스트입니다.
*   **경로 변환**: 스크립트는 빌드 디렉토리(`root_build_dir`)를 현재 작업 디렉토리(CWD)로 하여 실행됩니다. 따라서 소스 경로는 `rebase_path()`를 사용하여 빌드 디렉토리 기준 상대 경로로 변환해서 전달해야 합니다.

### `depfile`
스크립트가 `sources`나 `inputs`에 명시되지 않은 파일(예: 파이썬 스크립트가 내부적으로 import하는 모듈, 파싱하는 헤더 파일 등)을 읽는 경우, 이를 Ninja에게 알려주기 위해 사용합니다.
*   스크립트는 실행 시 Makefile 형식의 의존성 파일(`.d`)을 생성해야 하며, GN에서는 그 파일의 경로를 `depfile` 변수에 지정합니다.

## 3. `action` vs `action_foreach`

*   **`action`**: 스크립트를 **한 번** 실행합니다. 여러 입력 파일을 받아 하나의 출력을 만들거나, 입력을 한꺼번에 처리할 때 사용합니다.
*   **`action_foreach`**: `sources` 리스트의 **각 파일마다** 스크립트를 실행합니다. 1:1 변환(예: IDL 컴파일)에 적합합니다.

## 4. 예제: 헤더 파일 생성

```gn
action("generate_version_header") {
  script = "build/write_version.py"
  
  # 입력: 버전 정보 파일
  inputs = [ "//chrome/VERSION" ]
  
  # 출력: 생성될 헤더 파일
  outputs = [ "$target_gen_dir/version.h" ]

  args = [
    "--version-file", rebase_path("//chrome/VERSION", root_build_dir),
    "--output", rebase_path(outputs[0], root_build_dir),
  ]
}

executable("my_app") {
  sources = [ "main.cc" ]
  # 생성된 헤더를 사용하므로 의존성 추가
  deps = [ ":generate_version_header" ]
}
```
