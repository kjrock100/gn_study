# Chromium GN Loadable Module 타겟 가이드

`loadable_module` 타겟은 런타임에 로드되는 공유 라이브러리(Shared Library)를 생성합니다. `shared_library`와 유사하지만, 빌드 시점에 다른 타겟에 링크되지 않는다는 점이 핵심적인 차이입니다. 주로 플러그인(Plugin)이나 동적 로딩 모듈을 만들 때 사용됩니다.

## 1. 역할 (Role)

*   **런타임 로딩**: `dlopen()` (Linux/Mac)이나 `LoadLibrary()` (Windows)와 같은 API를 통해 프로그램 실행 중에 메모리로 로드됩니다.
*   **링킹 제외**: 다른 타겟이 이 타겟을 `deps`에 추가하더라도, 링커는 이를 링크하지 않습니다. 단지 빌드 순서(의존성)만 보장하여, 실행 파일이 실행되기 전에 모듈이 빌드되도록 합니다.

## 2. 기본 구조 (Basic Structure)

```gn
loadable_module("my_plugin") {
  sources = [ "plugin.cc" ]
  deps = [ "//base" ]
  defines = [ "MY_PLUGIN_IMPLEMENTATION" ]
}
```

## 3. 주요 변수 (Key Variables)

*   **`sources`**: 컴파일할 소스 파일 목록입니다.
*   **`deps`**: 이 모듈이 의존하는 다른 타겟 목록입니다.
*   **`configs`**: 컴파일러 설정 목록입니다.
*   **`output_name`**: 생성될 파일의 이름입니다. 기본값은 타겟 이름입니다.
*   **`output_extension`**: 생성될 파일의 확장자입니다. 기본값은 플랫폼별 공유 라이브러리 확장자(`.so`, `.dll`, `.dylib`)를 따르지만, macOS에서는 `.so`를 사용하는 경우가 많습니다.

## 4. `shared_library`와의 차이점

| 특징 | `shared_library` | `loadable_module` |
| :--- | :--- | :--- |
| **용도** | 다른 타겟이 링크하여 사용하는 라이브러리 | 런타임에 동적으로 로드되는 플러그인 |
| **링킹 동작** | `deps`에 추가하면 자동으로 링크됨 | `deps`에 추가해도 링크되지 않음 (빌드 순서만 보장) |
| **macOS 확장자** | `.dylib` | `.so` (Mach-O 번들 형식) |

## 5. 사용 예시 (Usage Examples)

### 플러그인 시스템 구성

```gn
# 1. 플러그인 정의
loadable_module("my_plugin") {
  sources = [ "plugin_impl.cc" ]
}

# 2. 메인 애플리케이션
executable("app") {
  sources = [ "main.cc" ]
  
  # 플러그인이 앱 실행 전에 빌드되어야 하므로 data_deps 사용
  # (deps를 써도 링크되지는 않지만, 런타임 데이터 의존성을 명확히 하기 위해 data_deps 권장)
  data_deps = [ ":my_plugin" ]
}
```

## 6. 주의사항

*   **macOS**: macOS에서 `loadable_module`은 일반적으로 `.so` 확장자를 가진 Mach-O 번들로 생성됩니다. 이는 `shared_library`가 생성하는 `.dylib`과는 다르며, 링커가 이를 일반 라이브러리처럼 링크하려고 하면 에러가 발생할 수 있습니다.
*   **심볼 노출**: 플러그인으로 사용되려면 호스트 프로그램이 찾을 수 있도록 진입점(Entry point) 함수 등을 `extern "C"` 및 적절한 visibility 속성(`__attribute__((visibility("default")))` 등)으로 노출해야 합니다.
