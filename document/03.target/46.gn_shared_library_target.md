# Chromium GN Shared Library 타겟 가이드

`shared_library` 타겟은 C/C++ 소스 코드를 컴파일하여 **동적 라이브러리(Dynamic Library)**를 생성하는 데 사용됩니다. 플랫폼에 따라 `.so` (Linux), `.dll` (Windows), `.dylib` (macOS) 확장자를 가진 파일이 생성됩니다.

## 1. 기본 구조 (Basic Structure)

```gn
shared_library("my_shared_lib") {
  sources = [
    "api.cc",
    "internal.cc",
  ]
  defines = [ "MY_SHARED_IMPLEMENTATION" ]
  deps = [ "//base" ]
}
```

## 2. 주요 변수 (Key Variables)

### `sources`
컴파일할 소스 파일 목록입니다.

### `deps`
이 라이브러리가 의존하는 다른 타겟 목록입니다.
*   `shared_library`가 다른 `shared_library`를 의존하면, 런타임 의존성이 형성됩니다.

### `defines`
전처리기 매크로를 정의합니다.
*   **Windows DLL 빌드 시 필수적**입니다. 소스 코드 내에서 심볼을 `__declspec(dllexport)`로 처리하기 위해 구현부임을 알리는 매크로를 정의해야 합니다.

### `output_name`
생성될 라이브러리 파일의 이름입니다. (기본값: 타겟 이름)
*   `lib` 접두사는 플랫폼 관례에 따라 자동으로 붙거나 붙지 않습니다.

### `output_extension`
파일 확장자를 강제로 지정합니다. (일반적으로는 설정하지 않고 기본값을 따릅니다.)

## 3. Windows DLL과 심볼 노출 (Symbol Visibility)

Windows에서 `shared_library`를 만들 때는 심볼을 명시적으로 내보내야(Export) 합니다.

1.  **헤더 파일**: 매크로를 사용하여 `dllexport`와 `dllimport`를 전환합니다.
    ```cpp
    // my_shared_lib.h
    #ifdef MY_SHARED_IMPLEMENTATION
    #define MY_SHARED_EXPORT __declspec(dllexport)
    #else
    #define MY_SHARED_EXPORT __declspec(dllimport)
    #endif

    class MY_SHARED_EXPORT MyClass { ... };
    ```

2.  **GN 설정**: 라이브러리를 빌드할 때만 `MY_SHARED_IMPLEMENTATION`을 정의합니다.
    ```gn
    shared_library("my_shared_lib") {
      defines = [ "MY_SHARED_IMPLEMENTATION" ]
      # ...
    }
    ```

## 4. `shared_library` vs `loadable_module`

*   **`shared_library`**: 빌드 시점에 링커에 의해 링크됩니다. 프로그램 시작 시(또는 라이브러리 로드 시) OS 로더에 의해 로드됩니다.
*   **`loadable_module`**: 빌드 시점에 링크되지 않습니다. 런타임에 `dlopen`이나 `LoadLibrary`를 통해 수동으로 로드하는 플러그인 용도입니다.

## 5. Chromium의 `component` 템플릿

Chromium 프로젝트에서는 `shared_library`를 직접 쓰기보다 `component` 템플릿을 주로 사용합니다.
*   `is_component_build = true` (Debug): `shared_library`로 빌드하여 링크 속도 향상.
*   `is_component_build = false` (Release): `static_library`로 빌드하여 실행 성능 및 배포 편의성 향상.

```gn
component("my_component") {
  sources = [ ... ]
  defines = [ "IS_MY_COMPONENT_IMPL" ]
}
```
