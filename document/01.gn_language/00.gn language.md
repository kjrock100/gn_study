
Chromium 프로젝트와 Fuchsia 등에서 사용하는 메타 빌드 시스템인 **GN (Generate Ninja)**에 대해 설명하는 Markdown 파일을 작성해 드립니다.

이 파일은 GN의 기본 개념, 문법, 주요 기능 및 예제 코드를 포함하여 구조적으로 정리되어 있습니다.

# Chromium GN (Generate Ninja) 가이드

GN은 Chromium 프로젝트를 위해 개발된 메타 빌드 시스템입니다. GN은 빌드 파일을 읽어 Ninja 빌드 파일(*.ninja)을 생성하는 역할을 합니다. 기존의 GYP(Generate Your Projects)보다 훨씬 빠르고, 가독성이 좋으며, 유지보수가 용이하도록 설계되었습니다.

## 1. GN의 주요 특징

- 속도: 매우 큰 프로젝트(Chromium 등)에서도 빌드 파일을 생성하는 속도가 매우 빠릅니다.
- 가독성: Python과 유사한 문법을 사용하여 읽고 쓰기 쉽습니다.
- 엄격함: 사용하지 않는 변수나 의존성에 대해 엄격하게 오류를 발생시켜 빌드 구성의 깔끔함을 유지합니다.
- 플랫폼 독립적: Windows, macOS, Linux 등 다양한 OS를 지원합니다.

## 2. 기본 문법 (Syntax)

GN 파일은 주로 BUILD.gn이라는 이름을 사용하며, .gni (GN Import) 파일은 공통 변수나 템플릿을 정의할 때 사용합니다.

### 변수와 자료형

GN은 동적 타이핑을 지원하지만, 리스트와 문자열 처리에 특화되어 있습니다.

```gn
  
# 변수 할당
my_string = "hello"
my_integer = 123
my_boolean = true

# 리스트 (가장 많이 사용됨)
my_list = [ "a.cc", "b.cc" ]

# 리스트 조작 (+=, -= 연산자 사용 권장)
my_list += [ "c.cc" ]
my_list -= [ "a.cc" ]
```

### 조건문 (Conditionals)

OS나 CPU 아키텍처, 빌드 설정에 따라 분기 처리가 가능합니다.

```gn
  
if (is_win) {
  sources += [ "win_impl.cc" ]
  defines = [ "WIN32" ]
} else if (is_linux) {
  sources += [ "linux_impl.cc" ]
} else {
  sources += [ "posix_impl.cc" ]
}
```

### 함수 호출

대부분의 빌드 정의는 내장 함수 호출로 이루어집니다.

```gn
print("Configuring build...")
assert(is_linux, "This build file is only for Linux")
```

### 3. 주요 타겟 (Targets)

GN의 핵심은 타겟을 정의하는 것입니다. 타겟은 실행 파일, 라이브러리, 소스 셋 등이 될 수 있습니다.

executable
실행 가능한 바이너리를 생성합니다.

```gn
executable("my_app") {
  sources = [
    "main.cc",
    "utils.cc",
  ]

  deps = [
    ":my_lib",
    "//base:base",  # 절대 경로 참조
  ]
}
```

static_library / shared_library

정적(.a, .lib) 또는 동적(.so, .dll, .dylib) 라이브러리를 생성합니다.

```gn
shared_library("my_shared_lib") {
  sources = [ "api.cc" ]
  defines = [ "MY_SHARED_IMPLEMENTATION" ]
}
```

source_set (중요)

Chromium에서 가장 많이 사용되는 타겟입니다. .a 파일(아카이브)을 생성하지 않고 객체 파일(.o)들의 집합으로 처리합니다.

- 장점: 링크 단계에서 필요한 객체 파일만 가져올 수 있어 링킹 속도가 빠르고 바이너리 크기가 최적화됩니다.

```gn
source_set("my_utils") {
  sources = [ "util.cc", "util.h" ]
  public_deps = [ "//third_party/icu" ]
}
```

group

실제 빌드 산출물은 없지만, 여러 의존성을 하나로 묶을 때 사용합니다.

```gn
  
group("tools") {
  deps = [
    "//tools/gn",
    "//tools/clang",
  ]
}
```

### 4. 의존성 관리 (Dependencies)

GN은 의존성 전파를 명확하게 관리합니다.

- deps: 현재 타겟이 컴파일/링크될 때 필요한 의존성입니다. 이 의존성의 헤더 경로나 설정은 현재 타겟까지만 전파됩니다.
- public_deps: 현재 타겟을 의존하는 다른 타겟에게도 설정을 전파해야 할 때 사용합니다. (예: 헤더 파일에 다른 라이브러리의 헤더를 include 하는 경우)

```gn
static_library("lib_a") {
  # lib_a를 사용하는 곳에서 lib_b의 헤더도 접근 가능해야 함
  public_deps = [ ":lib_b" ] 
  
  # lib_c는 lib_a 내부 구현에서만 사용됨
  deps = [ ":lib_c" ]
}
```

### 5. 설정 (Configs)

컴파일러 플래그, include 경로, define 등을 재사용 가능한 단위로 묶습니다.

```gn
  
config("my_config") {
  include_dirs = [ "include" ]
  cflags = [ "-Wall" ]
  defines = [ "ENABLE_FEATURE_X" ]
}

executable("app") {
  # 설정 적용
  configs += [ ":my_config" ]
  
  # 기본 설정 제거도 가능
  configs -= [ "//build/config/compiler:no_rtti" ]
}
```

### 6. 빌드 인자 (Build Arguments)

사용자가 gn args를 통해 설정할 수 있는 변수를 선언합니다.

```gn
  
declare_args() {
  enable_optimization = true
  use_custom_allocator = false
}

if (enable_optimization) {
  # ...
}
```

### 7. 템플릿 (Templates)

반복되는 빌드 로직을 함수처럼 정의하여 재사용합니다. GN의 강력한 기능 중 하나입니다.

```gn
# 템플릿 정의 (.gni 파일에 주로 위치)
template("my_test") {
  executable(target_name) {
    testonly = true
    sources = invoker.sources
    deps = invoker.deps + [ "//testing:gtest" ]
  }
}

# 템플릿 사용 (BUILD.gn)
my_test("unit_tests") {
  sources = [ "foo_test.cc" ]
  deps = [ ":foo" ]
}
```

### 8. 주요 명령어

터미널에서 사용하는 주요 GN 명령어입니다.

- gn gen out/Default: out/Default 디렉토리에 Ninja 빌드 파일을 생성합니다.
- gn args out/Default: 해당 빌드 디렉토리의 빌드 인자를 편집기를 열어 수정합니다.
- gn desc out/Default //path/to:target: 특정 타겟의 속성(소스, 의존성, 플래그 등)을 상세히 조회합니다.
- gn ls out/Default: 정의된 모든 타겟 목록을 보여줍니다.
- gn check out/Default: 헤더 파일 include가 deps에 올바르게 명시되어 있는지 검사합니다.

### 9. 전체 예제 (BUILD.gn)

```gn
  
# BUILD.gn

# 인자 선언
declare_args() {
  enable_gui = false
}

# 공통 설정
config("default_config") {
  include_dirs = [ "." ]
  if (is_debug) {
    defines = [ "DEBUG_MODE" ]
  }
}

# 유틸리티 라이브러리 (Source Set)
source_set("utils") {
  sources = [
    "utils.cc",
    "utils.h",
  ]
  public_configs = [ ":default_config" ]
}

# 메인 실행 파일
executable("my_app") {
  sources = [ "main.cc" ]

  deps = [ ":utils" ]

  if (enable_gui) {
    sources += [ "gui.cc" ]
    deps += [ "//third_party/qt" ]
  }
}
```

