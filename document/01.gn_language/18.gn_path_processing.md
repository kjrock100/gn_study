# Chromium GN 경로 처리 (Path Processing) 가이드

GN(Generate Ninja) 빌드 시스템에서 파일 경로를 올바르게 처리하는 것은 매우 중요합니다. 특히 빌드 스크립트(`action`)에 파일 경로를 전달하거나, 컴파일러 플래그를 설정할 때 경로 변환이 자주 필요합니다.

## 1. 경로의 종류 (Path Types)

GN은 크게 세 가지 유형의 경로를 다룹니다.

### 소스 절대 경로 (Source-Absolute)
*   `//`로 시작합니다.
*   `.gn` 파일이 있는 소스 루트 디렉토리를 기준으로 합니다.
*   GN 내에서 가장 권장되는 경로 형식입니다.
*   예: `//base/logging.h`

### 상대 경로 (Relative)
*   `//`나 `/`로 시작하지 않습니다.
*   현재 `BUILD.gn` 파일이 위치한 디렉토리를 기준으로 합니다.
*   예: `src/main.cc`, `../include/header.h`

### 시스템 절대 경로 (System-Absolute)
*   `/` (Linux/Mac) 또는 `C:\` (Windows)로 시작합니다.
*   빌드 머신의 파일 시스템 루트를 기준으로 합니다.
*   **주의**: 빌드 재현성(Hermetic build)을 위해 시스템 절대 경로는 사용을 지양해야 합니다.

## 2. `rebase_path` 함수

GN에서 가장 중요하고 자주 사용되는 경로 처리 함수입니다. 경로의 기준점(Base)을 변경합니다.

### 문법
```gn
result = rebase_path(input, new_base = "", current_base = ".")
```

*   **`input`**: 변환할 경로 (문자열 또는 리스트).
*   **`new_base`**: 결과 경로가 기준으로 삼을 디렉토리.
    *   생략하거나 빈 문자열(`""`)인 경우: **시스템 절대 경로**로 변환합니다.
    *   경로를 지정한 경우: 해당 디렉토리를 기준으로 한 **상대 경로**로 변환합니다.
*   **`current_base`**: 입력 경로(`input`)가 상대 경로일 경우, 무엇을 기준으로 해석할지 지정합니다. (기본값: 현재 `BUILD.gn` 디렉토리)

### 주요 사용 패턴

#### 1. 스크립트 인자로 경로 전달하기 (가장 흔한 패턴)
`action` 타겟에서 실행되는 스크립트는 보통 빌드 디렉토리(`root_build_dir`)를 현재 작업 디렉토리(CWD)로 하여 실행됩니다. 따라서 소스 파일 경로를 **빌드 디렉토리 기준의 상대 경로**로 변환해서 전달해야 합니다.

```gn
action("my_script") {
  script = "process.py"
  sources = [ "data/input.txt" ]
  
  # "data/input.txt"를 빌드 디렉토리(out/Default) 기준 상대 경로로 변환
  # 예: "../../my_module/data/input.txt"
  args = [
    "--input",
    rebase_path("data/input.txt", root_build_dir)
  ]
}
```

#### 2. 시스템 절대 경로 얻기
```gn
# 현재 디렉토리의 "foo.txt"를 시스템 절대 경로로 변환
abs_path = rebase_path("foo.txt")
```

## 3. `get_path_info` 함수

파일 경로에서 특정 정보를 추출하거나 형식을 변환합니다.

### 문법
```gn
result = get_path_info(input, what)
```

### `what` 옵션
*   `"file"`: 파일 이름 (확장자 포함).
*   `"name"`: 확장자를 제외한 파일 이름.
*   `"extension"`: 파일 확장자 (점 `.` 제외).
*   `"dir"`: 파일이 있는 디렉토리 경로.
*   `"abspath"`: 시스템 절대 경로.
*   `"gen_dir"`: 해당 소스 파일에 대응하는 생성 파일 디렉토리(`target_gen_dir`).
*   `"out_dir"`: 해당 소스 파일에 대응하는 출력 파일 디렉토리(`target_out_dir`).

## 4. 주요 디렉토리 변수

경로 처리 시 자주 사용되는 내장 변수들입니다.

*   **`root_build_dir`**: 빌드가 실행되는 최상위 디렉토리 (예: `out/Default`). `rebase_path`의 `new_base`로 가장 많이 사용됩니다.
*   **`root_gen_dir`**: 생성된 코드가 위치하는 루트 디렉토리 (예: `out/Default/gen`).
*   **`target_gen_dir`**: 현재 타겟의 위치에 대응하는 생성 파일 디렉토리. (예: `//foo/bar` 타겟이면 `out/Default/gen/foo/bar`).
