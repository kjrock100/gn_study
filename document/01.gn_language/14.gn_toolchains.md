# Chromium GN 툴체인 (Toolchains) 가이드

GN(Generate Ninja)에서 **툴체인(Toolchain)**은 소스 코드를 컴파일하고 링크하여 최종 빌드 산출물을 만드는 데 필요한 명령어들의 집합을 정의합니다. GN의 강력한 기능 중 하나는 단일 빌드 그래프 내에서 여러 툴체인(예: 타겟용, 호스트용, 다른 아키텍처용)을 동시에 사용할 수 있다는 점입니다.

## 1. 툴체인의 역할

*   **명령어 정의**: 컴파일러(CC, CXX), 링커(LINK), 아카이버(ALINK) 등 각 빌드 단계에서 실행할 구체적인 쉘 명령어를 지정합니다.
*   **크로스 컴파일 지원**: 메인 타겟은 ARM용으로 빌드하면서, 빌드 과정에 필요한 보조 도구는 x64 호스트용으로 빌드하는 등의 구성이 가능합니다.

## 2. 툴체인 정의 (Defining Toolchains)

`toolchain` 함수를 사용하여 정의합니다. 보통 `//build/toolchain/<platform>/BUILD.gn` 같은 경로에 위치합니다.

```gn
toolchain("my_toolchain") {
  tool("cc") { ... }
  tool("link") { ... }
  # 필수 도구: stamp, copy
  tool("stamp") { ... }
  tool("copy") { ... }
}
```

## 3. `tool` 함수와 종류

`toolchain` 블록 내부에서 `tool()` 함수를 사용하여 개별 도구를 정의합니다.

### 주요 도구 유형
*   `"cc"`, `"cxx"`: C/C++ 컴파일러.
*   `"asm"`: 어셈블러.
*   `"alink"`: 정적 라이브러리 아카이버 (Static Linker).
*   `"solink"`: 동적 라이브러리 링커 (Shared Object Linker).
*   `"link"`: 실행 파일 링커.
*   `"stamp"`: 타겟 완료를 표시하는 스탬프 파일 생성 도구 (**필수**).
*   `"copy"`: 파일 복사 도구 (**필수**).

## 4. 도구 변수 (Tool Variables)

각 `tool` 정의 내에서 사용하는 변수들입니다. GN은 이 변수들을 사용하여 Ninja 규칙을 생성합니다.

*   `command`: 실행할 쉘 명령어입니다. `{{source}}`, `{{output}}`, `{{cflags}}` 등의 치환 패턴을 사용합니다.
*   `outputs`: 명령어가 생성하는 파일의 경로 패턴입니다.
*   `depfile`: 컴파일러가 생성하는 의존성 파일(`.d`) 경로입니다. (헤더 파일 의존성 추적용)
*   `description`: 빌드 실행 시 콘솔에 출력할 메시지입니다.
*   `rspfile`, `rspfile_content`: 명령행 길이가 너무 길 경우 사용하는 응답 파일(Response File) 설정입니다.

## 5. 예제: 간단한 GCC 툴체인

```gn
toolchain("gcc") {
  tool("cc") {
    depfile = "{{output}}.d"
    command = "gcc -MMD -MF $depfile {{defines}} {{include_dirs}} {{cflags}} {{cflags_c}} -c {{source}} -o {{output}}"
    depsformat = "gcc"
    description = "CC {{output}}"
    outputs = [ "{{source_out_dir}}/{{target_output_name}}.{{source_name_part}}.o" ]
  }

  tool("link") {
    command = "gcc {{ldflags}} -o {{output}} {{inputs}} {{libs}}"
    description = "LINK {{output}}"
    outputs = [ "{{root_out_dir}}/{{target_output_name}}{{output_extension}}" ]
  }

  tool("stamp") {
    command = "touch {{output}}"
    description = "STAMP {{output}}"
  }

  tool("copy") {
    command = "cp -af {{source}} {{output}}"
    description = "COPY {{source}} {{output}}"
  }
}
```

## 6. 툴체인 선택 및 사용

*   **기본 툴체인**: `BUILDCONFIG.gn`에서 `set_default_toolchain("//path/to:toolchain")`을 통해 설정됩니다.
*   **툴체인 명시**: 타겟 라벨 뒤에 괄호를 사용하여 특정 툴체인을 지정할 수 있습니다.
    ```gn
    deps = [ "//tools/generator:my_gen(//build/toolchain/linux:clang_x64)" ]
    ```
*   **`host_toolchain`**: 빌드를 수행하는 머신의 툴체인을 가리키는 관례적인 변수입니다.
