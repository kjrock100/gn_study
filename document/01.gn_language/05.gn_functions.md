# Chromium GN 함수 (Functions) 가이드

GN(Generate Ninja)은 빌드 로직 제어, 타겟 정의, 파일 조작 등을 위해 다양한 내장 함수를 제공합니다. GN은 사용자가 직접 함수를 정의하는 기능(User-defined functions)은 없지만, **템플릿(Template)**을 통해 이를 대체합니다.

## 1. 일반 내장 함수 (General Built-in Functions)

빌드 흐름을 제어하거나 디버깅하는 데 사용됩니다.

### `print`
콘솔에 메시지를 출력합니다. 변수 값을 확인하거나 디버깅할 때 유용합니다.
```gn
print("Current OS: $current_os")
```

### `assert`
조건이 거짓(`false`)이면 빌드 생성을 중단하고 에러 메시지를 출력합니다.
```gn
assert(is_linux || is_android, "This library is only for Linux/Android")
```

### `import`
다른 `.gni` 파일을 현재 파일의 스코프로 가져옵니다. 공통 변수나 템플릿을 공유할 때 사용합니다.
```gn
import("//build/config/compiler/compiler.gni")
```

### `defined`
특정 변수가 현재 스코프에 정의되어 있는지 확인합니다.
```gn
if (defined(use_ozone) && use_ozone) { ... }
```

## 2. 타겟 정의 함수 (Target Functions)

빌드 산출물을 정의하는 핵심 함수들입니다. 이 함수들은 이름과 블록(`{}`)을 인자로 받아 내부 변수(`sources`, `deps` 등)를 설정합니다.

*   `executable`: 실행 파일 생성.
*   `shared_library`: 동적 라이브러리(`.so`, `.dll`) 생성.
*   `static_library`: 정적 라이브러리(`.a`, `.lib`) 생성.
*   `source_set`: 객체 파일(`.o`) 집합. (링킹 최적화에 유리하며 Chromium에서 선호됨)
*   `group`: 실제 산출물 없이 의존성만 묶을 때 사용.
*   `action`: 스크립트 실행을 통한 커스텀 빌드 단계 정의.

```gn
executable("my_tool") {
  sources = [ "tool.cc" ]
}
```

## 3. 파일 및 경로 조작 함수

### `read_file` / `write_file`
파일을 읽거나 씁니다. 주로 버전 정보를 읽거나 설정 파일을 생성할 때 사용합니다.

```gn
version = read_file("VERSION", "trim string")
```

### `rebase_path`
파일 경로를 특정 디렉토리 기준으로 변환합니다. 주로 `action` 타겟에서 스크립트에 경로를 전달할 때 사용합니다.

```gn
# 소스 루트(//) 기준 경로를 빌드 디렉토리(root_build_dir) 기준 상대 경로로 변환
args = [ rebase_path("//data/input.txt", root_build_dir) ]
```

### `get_path_info`
파일 경로에서 디렉토리, 파일명, 확장자 등의 정보를 추출합니다.

```gn
file = "src/foo.cc"
dir = get_path_info(file, "dir")  # "src"
name = get_path_info(file, "name") # "foo"
```

## 4. 템플릿 (Templates) - 사용자 정의 함수

GN에서는 `template` 키워드를 사용하여 재사용 가능한 빌드 규칙(함수와 유사)을 정의합니다.

### 템플릿 정의
`.gni` 파일이나 `BUILD.gn` 상단에 정의합니다.

```gn
template("my_test") {
  executable(target_name) {
    testonly = true
    # invoker를 통해 호출 시 전달된 변수에 접근
    sources = invoker.sources
    deps = invoker.deps + [ "//testing:gtest" ]
  }
}
```

### 템플릿 사용
```gn
my_test("unit_tests") {
  sources = [ "foo_test.cc" ]
  deps = [ ":foo" ]
}
```
